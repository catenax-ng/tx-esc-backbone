# Copyright (c) 2022-2023 - for information on the respective copyright owner
# see the NOTICE file and/or the repository at
# https://github.com/catenax-ng/product-esc-backbone-code
#
# SPDX-License-Identifier: Apache-2.0
# syntax=docker/dockerfile:1.4
FROM golang:1.19.1-bullseye as esc-backbone-build-base
ENV PACKAGES bash curl
RUN apt-get update && \
    apt-get upgrade -y && \
    apt-get install -y $PACKAGES && \
    apt-get clean

RUN go install github.com/tomwright/dasel/cmd/dasel@v1.26.1
WORKDIR /output
RUN cp `which dasel` /output

ONBUILD RUN apt-get update && \
            apt-get upgrade -y && \
            apt-get remove --purge --auto-remove -y && \
            apt-get clean

FROM debian:11.5-slim as esc-backbone-debian-base
RUN apt-get update && \
    apt-get upgrade -y && \
    apt-get remove --purge --auto-remove -y && \
    apt-get clean

ONBUILD RUN apt-get update && \
            apt-get upgrade -y && \
            apt-get remove --purge --auto-remove -y && \
            apt-get clean

FROM node:17.9 as esc-backbone-web-build-base
WORKDIR /build/web
COPY web/package.json web/package-lock.json ./
RUN npm install

FROM nginxinc/nginx-unprivileged:1.23 as esc-backbone-web-base
USER 0
RUN apt-get update && \
    apt-get upgrade -y && \
    apt-get install -y jq &&  \
    apt-get remove --purge --auto-remove -y && \
    apt-get clean

ONBUILD USER 0
ONBUILD RUN apt-get update && \
            apt-get upgrade -y && \
            apt-get remove --purge --auto-remove -y && \
            apt-get clean